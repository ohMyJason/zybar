<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>风口交易吧后台</title>
    <script src="../../user/js/jquery-3.1.1.min.js"></script>
    <script src="../../user/js/jquery.cookie.js"></script>

    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../layui/layui.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/backWebSocket.js"></script>
    <style>
        #fwTeacherChat img{
            width: 80%;
        }
    </style>
</head>
<body class="layui-layout-body">



        <!-- 内容主体区域 -->


        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>风云战队专属直播间</legend>
            <div style="margin-top: 20px">
                <div style="width: 70%; margin: 0;">
                    <button type="button" id="editMessage" style="float: left" class="layui-btn">发送消息</button>
                    <button type="button" id="addStrategy" style="float: left" class="layui-btn">添加策略</button>
                    <button type="button" id="createStrategy" style="float: left" class="layui-btn">查看建仓策略</button>
                    <button type="button" id="closeStrategy" style="float: left" class="layui-btn">查看平仓策略</button>
                    <input type="hidden" id="selectOnline" value="3">
                    <button style="float: left;margin-left: 10%" type="button" id="restReply" class="layui-btn">取消回复</button>
                    <blockquote style="float: left;margin-left: 10%" class="layui-elem-quote" id="replayName">无选择回复</blockquote>
                </div>
            </div>
            <script type="text/javascript" src="../wangEditor-3.1.1/release/wangEditor.min.js"></script>
            <script>
                $(function () {
                    $("#fwUserChat").on('click','.layui-card',function () {
                        var replay = $(this).children().eq(0).text()+":"+$(this).children().eq(1).text().trim();
                        console.log(replay);
                        $("#replayName").text(replay);

                    })

                    $("#restReply").click(function () {
                        $("#replayName").text("无选择回复");
                    })

                    $("#addStrategy").click(function () {
                        layer.open({
                            type:2,
                            title:"推送策略",
                            area: ['80%','90%'],
                            shadeClose:true,
                            content:"/back/content/add-strategy.html?selectLive=3"
                        })
                    })

                    $("#closeStrategy").click(function () {
                        layer.open({
                            type:2,
                            title:"查看平仓策略",
                            area: ['80%','60%'],
                            shadeClose:true,
                            content:"/back/model/hjCloseStrategy.html?selectLive=3"
                        })
                    })

                    $("#createStrategy").click(function () {
                        layer.open({
                            type:2,
                            title:"查看建仓策略",
                            area: ['90%','90%'],
                            shadeClose:true,
                            content:"/back/model/hjStrategy.html?selectLive=3"
                        })
                    })


                    $("#editMessage").click(function () {
                        layer.open({
                            type: 1,
                            title: "直播间",
                            area: ['800px', '600px'],
                            shadeClose: true,
                            content: "<div id=\"editor\">\n" +
                                "\n" +
                                "</div>\n" +
                                "\n" +
                                "<div style=\"margin-top: 20px\">\n" +
                                "    <button style=\"margin-right: 20px\" type=\"button\" class=\"layui-btn layui-btn-normal\" id=\"send\">发送</button>\n" +
                                "</div>"//这里content是一个普通的String
                        });
                        var E = window.wangEditor
                        var editor = new E('#editor')
                        editor.customConfig.uploadImgServer = '/uploadChatImg'

                        editor.customConfig.uploadFileName = 'file'                        // 或者 var editor = new E( document.getElementById('editor') )
                        editor.create()

                        $("#send").click(function () {
                            var content = editor.txt.html();
                            console.log(content)
                            if (websocket.readyState !== 1) {
                                layui.use('layer', function () {
                                    var layer = layui.layer;
                                    layer.alert("直播间连接出现错误,请刷新页面重新连接");
                                })
                            }else {
                                var message  = {role:2,content:content,username:$.cookie("username"),photoUrl:$.cookie("photoUrl"),selectOnline:$("#selectOnline").val(),replay:$("#replayName").text(),sentTime:new Date().toLocaleString()}
                                websocket.send(JSON.stringify(message));
                                ajaxPOST("/insertMessage",{message:JSON.stringify(message),selectOnline:0},function f(res) {
                                    if (res.code==0){
                                        layer.msg('发送成功');
                                    } else {
                                        layer.msg('操作失败');
                                    }

                                })
                            }
                            $("#replayName").text("无选择回复");
                        });

                    })

                })
            </script>
            <hr class="layui-bg-red">
            <div class="layui-col-md6">
                <legend>老师消息</legend>

            </div>
            <div class="layui-col-md6">
                <legend>网友消息</legend>

            </div>

        </fieldset>


        <div style="padding: 20px; background-color: #F2F2F2;">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md6" style="height: 400px;overflow: auto" id="fwTeacherChat">
                    <!--<div class="layui-card" id="chatModel">-->
                    <!--<div class="layui-card-header">用户名</div>-->
                    <!--<div class="layui-card-body">-->
                    <!--卡片式面板面板通常用于非白色背景色的主体内<br>-->
                    <!--从而映衬出边框投影-->
                    <!--</div>-->
                    <!--</div>-->
                </div>
                <div class="layui-col-md6" style="height: 400px;overflow: auto" id="fwUserChat">
                    <!--<div class="layui-card">-->
                    <!--<div class="layui-card-header">用户名</div>-->
                    <!--<div class="layui-card-body">-->
                    <!--结合 layui 的栅格系统<br>-->
                    <!--轻松实现响应式布局-->
                    <!--</div>-->
                    <!--</div>-->
                </div>

            </div>
        </div>



<script>
    //JavaScript代码区域
    layui.use('element', function () {
        var element = layui.element;

        //虚假的局部刷新，通过改变css让左边导航显示对应块
        $("#viewOnline").attr("class", "layui-nav-item layui-nav-itemed")


        getHistoryMsg(3);  //获取历史消息

    });
</script>
</body>
</html>
